# MS-AI-Viewer
# MS-AI-Viewer

ì´Â í”„ë¡œì íŠ¸ëŠ”Â **ì‚°ì—…ìš©Â ì˜ìƒ ê°ì‹œ ì‹œìŠ¤í…œ**ì˜ í´ë¼ì´ì–¸íŠ¸ë¡œì„œ,Â **ì‹¤ì‹œê°„ ì˜ìƒ ì²˜ë¦¬**,Â **AIÂ ì—°ë™**,Â **ë©€í‹°ìŠ¤ë ˆë”© GUI**Â ë“±Â ë‹¤ì–‘í•œ ê¸°ìˆ ì Â ë„ì „ì„ í¬í•¨í•œÂ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤

## **ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”**

| í•­ëª© | ë‚´ìš© |
| --- | --- |
| **í”„ë¡œì íŠ¸ëª…** | MS-AI-ViewerÂ (ì§€ëŠ¥í˜• ì˜ìƒ ê°ì‹œ ì‹œìŠ¤í…œÂ í´ë¼ì´ì–¸íŠ¸) |
| **ë²„ì „** | v1.7.0 |
| **ê°œë°œÂ í”Œë«í¼** | Windows, LinuxÂ (Raspberry Pi í˜¸í™˜) |
| **ê°œë°œ ì–¸ì–´** | Python |

## **ğŸ¯ í”„ë¡œì íŠ¸Â ëª©ì **

AIÂ ê¸°ë°˜ ì˜ìƒ ë¶„ì„ ì„œë²„ì™€Â ì—°ë™í•˜ì—¬Â **ì‹¤ì‹œê°„ CCTV ì˜ìƒ ëª¨ë‹ˆí„°ë§**Â ë°Â **ì´ìƒÂ í–‰ë™ ê°ì§€Â ì•Œë¦¼**ì„ ì œê³µí•˜ëŠ”Â **ë°ìŠ¤í¬íƒ‘ í´ë¼ì´ì–¸íŠ¸Â ì• í”Œë¦¬ì¼€ì´ì…˜**ì…ë‹ˆë‹¤.

## **ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ**

**FrontendÂ (GUI)**

| ê¸°ìˆ  | ìš©ë„ |
| --- | --- |
| **PySide6Â (Qt6)** | ë°ìŠ¤í¬íƒ‘ GUI í”„ë ˆì„ì›Œí¬ |
| **QtÂ Designer** | UIÂ ë ˆì´ì•„ì›ƒ ì„¤ê³„Â (.ui íŒŒì¼) |
| **QThread** | ë¹„ë™ê¸°Â ë©€í‹°ìŠ¤ë ˆë”© ì²˜ë¦¬ |
| **QPropertyAnimation** | UIÂ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ |

**BackendÂ /Â ì˜ìƒ ì²˜ë¦¬**

| ê¸°ìˆ  | ìš©ë„ |
| --- | --- |
| **GStreamerÂ (GI)** | RTSP ì‹¤ì‹œê°„ ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° |
| **OpenCV** | ì˜ìƒÂ ì²˜ë¦¬ ë° ì´ë¯¸ì§€Â ë³€í™˜ |
| **NumPy** | í”„ë ˆì„Â ë°ì´í„° ì²˜ë¦¬ |

**í†µì‹ Â /Â ë³´ì•ˆ**

| ê¸°ìˆ  | ìš©ë„ |
| --- | --- |
| **RESTful APIÂ (requests)** | AI ì„œë²„Â í†µì‹  |
| **FernetÂ (cryptography)** | ì„¤ì • íŒŒì¼ ì•”í˜¸í™” |
| **HTTPBasicAuth** | NVRÂ ì¸ì¦ |

**ì™¸ë¶€ ì—°ë™**

| ê¸°ìˆ  | ìš©ë„ |
| --- | --- |
| **Solapi** | SMS/ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ ë°œì†¡ |
| **SystemÂ Tray** | ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ |

## **ğŸ’¡Â í•µì‹¬ ê¸°ëŠ¥**

**1. ì‹¤ì‹œê°„Â RTSP ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°#Â GStreamerÂ íŒŒì´í”„ë¼ì¸ì„Â í™œìš©í•œÂ ì €ì§€ì—°Â ì˜ìƒÂ ì²˜ë¦¬**

```python
# GStreamer íŒŒì´í”„ë¼ì¸ì„ í™œìš©í•œ ì €ì§€ì—° ì˜ìƒ ì²˜ë¦¬
class Video_Buffer:
    def __init__(self, pipe, appsink_name, resolution, fps):
        self.video_source = f'rtspsrc location=rtsp://{pipe} latency=10'
        self.video_decode = f'! decodebin ! videorate ! videoscale ! videoconvert'
        # H.264 ë””ì½”ë”© â†’ OpenCV BGR ë³€í™˜
```

**íŠ¹ì§•:**

- ì €ì§€ì—°(latency=10ms) RTSPÂ ìŠ¤íŠ¸ë¦¬ë°
- ë™ì Â í”„ë ˆì„ë ˆì´íŠ¸ ë³€ê²½ ì§€ì›
- ìë™ ì¬ì—°ê²° ë©”ì»¤ë‹ˆì¦˜Â (EOS/ErrorÂ ê°ì§€)
- íƒ€ì„ì•„ì›ƒ ê¸°ë°˜Â ë¹„ë””ì˜¤ ë¦¬ë”Â (ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘)

**2. AIÂ ê°ì§€ ê²°ê³¼ ì‹œê°í™”**

```python
# 6ê°€ì§€ ì´ë²¤íŠ¸ ìœ í˜•ë³„ ìƒ‰ìƒ êµ¬ë¶„
COLOR = {
    0: (0, 150, 95),    # person - ì´ˆë¡
    1: (0, 242, 255),   # bicycle - ë…¸ë‘
    2: (180, 130, 70),  # car - íŒŒë‘
    6: (147, 20, 255),  # fire - í•‘í¬
}
```

**ì§€ì› ê°ì§€ ìœ í˜•:**

- ğŸ‘¤Â **ì¹¨ì…Â (Intrusion)**Â - ROI ì˜ì—­ ë‚´ ì‚¬ëŒ ê°ì§€
- ğŸš¶Â **ë°°íšŒ (Loitering)**Â - ì¼ì • ì‹œê°„ ì²´ë¥˜Â ê°ì§€
- ğŸ”»Â **ì“°ëŸ¬ì§Â (Falldown)**Â -Â ë‚™ìƒÂ ê°ì§€
- ğŸ”¥Â **ë°©í™” (Fire)**Â - í™”ì¬ ê°ì§€
- ğŸ‘ŠÂ **ì‹¸ì›€ (Fight)**Â - ê²©íˆ¬Â í–‰ìœ„ ê°ì§€
- ğŸ—‘ï¸Â **ë¬´ë‹¨íˆ¬ê¸°Â (Trash)**Â - ë¶ˆë²• íˆ¬ê¸° ê°ì§€

**3. ë©€í‹°ìŠ¤ë ˆë”© ì•„í‚¤í…ì²˜**

```python
class CheckAlarmThread(QThread):
    """AI ì„œë²„ ì•ŒëŒ ì²´í¬ë¥¼ ìœ„í•œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ"""
    new_alarm = Signal(str, str, str, str, str, str, str)
    
    def run(self):
        while self._is_running:
            # 1ì´ˆ ì£¼ê¸°ë¡œ AI ì„œë²„ ì•ŒëŒ ì²´í¬
            alarm_data = requests.get(alarm_url, timeout=1)
            # ìƒˆë¡œìš´ ì•ŒëŒ ë°œìƒ ì‹œ Signal ë°œì‹ 
            self.new_alarm.emit(title, message, ...)
```

**ìŠ¤ë ˆë“œ êµ¬ì¡°:**

| ìŠ¤ë ˆë“œ | ì—­í•  |
| --- | --- |
| Connect_Camera | ì¹´ë©”ë¼ë³„Â ì˜ìƒ ìˆ˜ì‹  |
| CheckAlarmThread | AI ì„œë²„ ì•ŒëŒÂ í´ë§Â (1ì´ˆ ì£¼ê¸°) |
| UpdateCameraImageThread | ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ |
| RtspVideoReader | íƒ€ì„ì•„ì›ƒ ê¸°ë°˜Â ì˜ìƒÂ ì½ê¸° |

**4. ì»¤ìŠ¤í…€ ì•Œë¦¼ ì‹œìŠ¤í…œ**

```python
class CustomNotification(QWidget):
    """ëª¨ë˜ ë””ìì¸ ì•Œë¦¼ ìœ„ì ¯ (Windows/ë¼ì¦ˆë² ë¦¬íŒŒì´ í˜¸í™˜)"""
    def slide_in(self, target_pos):
        # í™”ë©´ í•˜ë‹¨ì—ì„œ ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
        self.animation_geometry.setStartValue(start_rect)
        self.animation_geometry.setEndValue(end_rect)
        
    def fade_out(self):
        # ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ì•„ì›ƒ (íˆ¬ëª…ë„ ëŒ€ì‹  - ë¼ì¦ˆë² ë¦¬íŒŒì´ í˜¸í™˜)
```

**íŠ¹ì§•:**

- ìµœëŒ€Â 10ê°œ ì•Œë¦¼ ìŠ¤íƒœí‚¹
- ìë™ ìœ„ì¹˜ ì¬ì •ë ¬ ì• ë‹ˆë©”ì´ì…˜
- í´ë¦­ ì‹œÂ í•´ë‹¹ ì¹´ë©”ë¼ í™”ë©´ìœ¼ë¡œ ì´ë™
- ë¼ì¦ˆë² ë¦¬íŒŒì´Â X11 í™˜ê²½ í˜¸í™˜Â (íˆ¬ëª…ë„Â â†’ ìœ„ì¹˜ ì• ë‹ˆë©”ì´ì…˜)

**5. ROI(ê´€ì‹¬ì˜ì—­) ì„¤ì •**

```python
class Plot_Camera_Viewer(QLabel):
    def paintEvent(self, event):
        # í™œì„± ì˜ì—­: ì´ˆë¡ìƒ‰ ë°˜íˆ¬ëª…
        fillColor = QColor(129, 215, 66, 127)
        painter.drawPolygon(polygon)
        
        # ë¹„í™œì„± ì˜ì—­: íšŒìƒ‰ ë°˜íˆ¬ëª…
        gray_fillColor = QColor(84, 84, 84, 127)
```

- ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ ë‹¤ê°í˜• ROI ì§€ì •
- ì‹¤ì‹œê°„ ì˜ì—­Â ì‹œê°í™”
- ë‹¤ì¤‘Â ROI ì§€ì›Â (í™œì„±/ë¹„í™œì„± êµ¬ë¶„)

**6.Â ë“œë˜ê·¸Â & ë“œë¡­ ì¹´ë©”ë¼ ê´€ë¦¬**

```python
def make_tree_draggable_with_data(tree_widget, ai_server_info_dict):
    """Treeì—ì„œ í…Œì´ë¸”ë¡œ ì¹´ë©”ë¼ ë“œë˜ê·¸ & ë“œë¡­"""
    # NVR Tree â†’ AI ì„œë²„ ì¹´ë©”ë¼ í…Œì´ë¸” ë“±ë¡
    # í…Œì´ë¸” ì™¸ë¶€ë¡œ ë“œë¡­ â†’ ì¹´ë©”ë¼ ì‚­ì œ
```

**7. ì•”í˜¸í™”ëœÂ ì„¤ì • ê´€ë¦¬**

```python
def load_crypography_json(info_filename):
    fernet = Fernet(KEY)
    with open(info_filename, "rb") as f:
        file_tran = fernet.decrypt(f.read())
        return json.loads(file_tran.decode())
```

**ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜**

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MS-AI-Viewer (Client)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Login UI   â”‚  â”‚  Main UI    â”‚  â”‚  Popup Windows      â”‚  â”‚
â”‚  â”‚  (ì¸ì¦)     â”‚â†’ â”‚  (ë©”ì¸í™”ë©´) â”‚  â”‚  - AI ì„¤ì •          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  - ìŠ¤ì¼€ì¤„           â”‚  â”‚
â”‚                          â”‚         â”‚  - ê²€ìƒ‰             â”‚  â”‚
â”‚                          â–¼         â”‚  - ë¼ë²¨ë§           â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  - ê°ì²´ ì„¤ì •        â”‚  â”‚
â”‚  â”‚       QThread Workers       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  - Connect_Camera (ì˜ìƒ)    â”‚                            â”‚
â”‚  â”‚  - CheckAlarmThread (ì•ŒëŒ)  â”‚                            â”‚
â”‚  â”‚  - UpdateCameraImageThread  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NVR Server â”‚   â”‚  AI Server  â”‚
â”‚  (RTSP)     â”‚   â”‚  (REST API) â”‚
â”‚  - H.264    â”‚   â”‚  - ì•ŒëŒ     â”‚
â”‚  - ì¹´ë©”ë¼   â”‚   â”‚  - ì„¤ì •     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **ğŸ–¥ï¸ UIÂ êµ¬ì„±**

| í™”ë©´ | íŒŒì¼ | ê¸°ëŠ¥ |
| --- | --- | --- |
| ë¡œê·¸ì¸ | ui_login.py | ì‚¬ìš©ì ì¸ì¦ |
| ë©”ì¸ | ui_main.py | ëŒ€ì‹œë³´ë“œ, NVR/AIì„œë²„ ê´€ë¦¬ |
| AIÂ ì„¤ì • | ui_ai_setting.py | ê°ì§€ ìœ í˜•ë³„Â ì„¤ì • |
| ê²€ìƒ‰ | ui_search.py | ì´ë²¤íŠ¸ ë¡œê·¸ ì¡°íšŒ |
| ìŠ¤ì¼€ì¤„ | ui_schedule.py | ê°ì§€ ìŠ¤ì¼€ì¤„ ì„¤ì • |
| ë¼ë²¨ë§ | ui_ai_labeling.py | AIÂ í•™ìŠµ ë°ì´í„° ë¼ë²¨ë§ |
| ê°ì²´ ì„¤ì • | ui_object_setting.py | ê°ì§€ ê°ì²´ ì„¤ì • |
| ì„œë²„ ì„¤ì • | ui_server_setting.py | NVR/AIì„œë²„Â ê´€ë¦¬ |

## **ğŸ”” ì™¸ë¶€ ì—°ë™**

**SMSÂ / ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡**

```python
from solapi import SolapiMessageService

# ì´ë²¤íŠ¸ ê°ì§€ ì‹œ ì•Œë¦¼ ë°œì†¡
kakao_option = KakaoOption(
    pf_id="KA01PF...",
    template_id="KA01TP...",
    variables={
        "#{detect_type}": str(ai_type),
        "#{camera_name}": str(camera_name),
        "#{current_time}": str(current_time)
    }
)
```

**âš™ï¸ ì„¤ì¹˜ í™˜ê²½**

```bash
# Conda í™˜ê²½
conda install conda-forge::pygobject
conda install conda-forge::cryptography
conda install conda-forge::pyside6
conda install conda-forge::gst-plugins-base
conda install conda-forge::gst-plugins-good
conda install conda-forge::gst-plugins-bad

# pip
pip install opencv-python numpy requests solapi
```

## **ğŸ“ˆ í”„ë¡œì íŠ¸ ê·œëª¨**

| í•­ëª© | ìˆ˜ì¹˜ |
| --- | --- |
| ë©”ì¸ ì½”ë“œ ë¼ì¸ | ~2,300 linesÂ (main.py) |
| ìœ í‹¸ë¦¬í‹° ì½”ë“œ ë¼ì¸ | ~1,300 lines (utils.py) |
| UIÂ íŒŒì¼ | 10ê°œ (.uiÂ / .py) |
| ì§€ì› ê°ì§€ ìœ í˜• | 6ì¢… |
| ë¦¬ì†ŒìŠ¤ ì´ë¯¸ì§€ | 56ê°œ |

---

## **ğŸ–ï¸Â í•µì‹¬ ì—­ëŸ‰**

### **1.Â ì‹¤ì‹œê°„ ì˜ìƒ ì²˜ë¦¬**

- GStreamer íŒŒì´í”„ë¼ì¸ ì„¤ê³„ ë° ìµœì í™”
- ì €ì§€ì—° RTSP ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„
- ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘ (íƒ€ì„ì•„ì›ƒ, ìë™Â ì¬ì—°ê²°)

### **2.Â GUIÂ ì• í”Œë¦¬ì¼€ì´ì…˜Â ê°œë°œ**

- PySide6/Qt6 ê¸°ë°˜ ë°ìŠ¤í¬íƒ‘Â ì•± ê°œë°œ
- ë©€í‹°ìŠ¤ë ˆë”© UIÂ (QThreadÂ + Signal/Slot)
- ì»¤ìŠ¤í…€ ìœ„ì ¯ ë° ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„

### **3.Â ì‹œìŠ¤í…œ í†µí•©**

- RESTÂ API ê¸°ë°˜ ì„œë²„Â í†µì‹ 
- NVR/AIÂ ì„œë²„ ì—°ë™
- ì™¸ë¶€ ì•Œë¦¼ ì„œë¹„ìŠ¤ ì—°ë™Â (SMS/ì¹´ì¹´ì˜¤í†¡)

### **4.Â ë³´ì•ˆ**

- ì„¤ì • íŒŒì¼ ì•”í˜¸í™”Â (Fernet)
- ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬

---

## **ğŸ“ ê°œì„  ê°€ëŠ¥Â ì˜ì—­**

1. **ë¹„ë™ê¸° ì²˜ë¦¬Â ê°œì„ **Â - asyncio ë„ì…ìœ¼ë¡œ I/O íš¨ìœ¨í™”
2. **í…ŒìŠ¤íŠ¸ ì½”ë“œ**Â - pytestÂ ê¸°ë°˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸Â ì¶”ê°€
3. **ë¡œê¹…Â ì‹œìŠ¤í…œ**Â - ì²´ê³„ì ì¸ ë¡œê¹…Â ì¸í”„ë¼ êµ¬ì¶•
4. **DockerÂ ì§€ì›**Â -Â ì»¨í…Œì´ë„ˆÂ ê¸°ë°˜ ë°°í¬ í™˜ê²½

---

## ë¡œê·¸ì¸
![Image](https://github.com/user-attachments/assets/0b0714c5-84ca-426f-aa03-65699909d12d)

## ë©”ì¸
![Image](https://github.com/user-attachments/assets/92b561f3-8d36-400e-a0f0-92fc36b95459)

![Image](https://github.com/user-attachments/assets/cc2a32bc-2355-480f-92a6-1d3ad5c31d58)

## ì´ë²¤íŠ¸ ê²€ìƒ‰
![Image](https://github.com/user-attachments/assets/409eee3f-2733-46b9-b174-4c0772f577cc)

## ì„¤ì •
![Image](https://github.com/user-attachments/assets/84c8d0da-c5cf-49ab-b6b8-b05443b6b535)

## ë¼ë²¨ë§
![Image](https://github.com/user-attachments/assets/84af04c7-1463-4c62-9717-258057919aa3)

## ìŠ¤ì¼€ì¤„
![Image](https://github.com/user-attachments/assets/c5f42bae-0e31-431b-96c2-d5daed717a20)
